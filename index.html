<!DOCTYPE html>
<html>
<head>
  <title>Let's get to work!</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1em; }
    input, select { margin-bottom: 1em; padding: 0.5em; width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    thead tr {
      background-color: #305063;
      color: white;
    }
    th, td { padding: 0.5em; border: 1px solid #ccc; text-align: left; }
    a { color: #1a73e8; text-decoration: underline; }
    .pagination {
      margin-top: 1em;
    }
    .pagination button {
      padding: 0.5em 1em;
      margin-right: 0.5em;
      font-size: 1em;
      cursor: pointer;
    }
    .pagination button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
    .pagination span {
      font-size: 1em;
      vertical-align: middle;
    }
  </style>
</head>
<body>

  <h2>Let's get to work!</h2>
  
  <input type="text" id="search-input" placeholder="Search by name" />
  
  <select id="filter-select">
    <option value="">All Next steps</option>
  </select>
  
  <table id="data-table" aria-describedby="page-info" role="table">
    <thead>
      <tr><th scope="col">Click to edit</th><th scope="col">Next step</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination" role="region" aria-label="Pagination controls">
    <button id="prev-btn" disabled aria-disabled="true">Previous</button>
    <button id="next-btn" disabled aria-disabled="true">Next</button>
    <span id="page-info" aria-live="polite" style="margin-left: 1em;"></span>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRus4kFg2V9ITptF_g9OZnYV399uqeSrjKKMD8hJZGmKFZs275TDJy1ZxZDVZv_KB5Aed5gjK4_EL78/pub?gid=384521337&single=true&output=csv';
    let data = [];
    let filteredData = [];
    const rowsPerPage = 50;
    let currentPage = 1;

    // Create hyperlink if text is a valid URL
    function makeLink(text) {
      try {
        let url = new URL(text);
        return `<a href="${url.href}" target="_blank" rel="noopener noreferrer">${text}</a>`;
      } catch {
        return text;
      }
    }

    function renderTablePage(page) {
      const tbody = document.querySelector('#data-table tbody');
      tbody.innerHTML = '';

      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      if (pageData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="2">No matching results</td></tr>';
        document.getElementById('page-info').textContent = 'No results found.';
        document.getElementById('prev-btn').disabled = true;
        document.getElementById('next-btn').disabled = true;
        return;
      }

      pageData.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${makeLink(row['Click to edit'])}</td><td>${row['Next step']}</td>`;
        tbody.appendChild(tr);
      });

      const totalPages = Math.ceil(filteredData.length / rowsPerPage);
      document.getElementById('page-info').textContent =
        `Page ${currentPage} of ${totalPages} (${filteredData.length} results)`;
      
      document.getElementById('prev-btn').disabled = currentPage === 1;
      document.getElementById('next-btn').disabled = currentPage === totalPages;
    }

    function populateFilterOptions() {
      const select = document.getElementById('filter-select');
      const steps = [...new Set(data.map(d => d['Next step']).filter(Boolean))];
      steps.sort();
      steps.forEach(step => {
        const option = document.createElement('option');
        option.value = step;
        option.textContent = step;
        select.appendChild(option);
      });
    }

    function filterData() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const selectedStep = document.getElementById('filter-select').value;

      filteredData = data.filter(row => {
        const clickToEdit = (row['Click to edit'] || '').toLowerCase();
        const nextStep = row['Next step'] || '';
        const matchesSearch = clickToEdit.includes(searchTerm);
        const matchesStep = selectedStep === '' || nextStep === selectedStep;
        return matchesSearch && matchesStep;
      });

      currentPage = 1; // Reset to first page on filter/search change
      renderTablePage(currentPage);
    }

    document.getElementById('search-input').addEventListener('input', filterData);
    document.getElementById('filter-select').addEventListener('change', filterData);

    document.getElementById('prev-btn').addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderTablePage(currentPage);
      }
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      if (currentPage < Math.ceil(filteredData.length / rowsPerPage)) {
        currentPage++;
        renderTablePage(currentPage);
      }
    });

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: (results) => {
        data = results.data.filter(row => row['Click to edit']); // Remove empty rows
        populateFilterOptions();
        filterData();
      },
      error: (err) => {
        console.error('Error loading CSV:', err);
      }
    });
  </script>

</body>
</html>
